<!DOCTYPE html>
<html>
	<head>
		<meta charset="utf-8">
		<title>自适应瀑布流</title>
		<style type="text/css">
			*{
				margin: 0;
				padding: 0;
			}
			.box{
				width: 100%;
				height: 100%;
				position: relative;
			}
			.box ul{
				width: 200px;
				list-style: none;
				margin-top: 10px;
				float: left;
				position: absolute;
			}
			.box ul li{
				margin-top: 10px;
			}
			.box img{
				width: 200px;
			}
		</style>
	</head>
	<body>
		<div class="box">
		
		</div>
	</body>
</html>
<script src="./ajax.js"></script>
<script type="text/javascript">
	window.onload = function(){
		loadImg();
	}
	window.onresize = function(){
		loadImg();
	}
	
	//删除之前的ul
	function oUlDelete(){
		var oBox = document.querySelector('.box');
		var oUl = oBox.querySelectorAll('ul');
		for(var i=0;i<oUl.length;i++){
			oBox.removeChild(oUl[i]);
		}
	}
	//生成ul
	function waterFull(){
		
		var oBox = document.querySelector('.box');
		//大盒子宽度
		var oBox_width = oBox.offsetWidth;
		//ul的宽度
		var oUl_width = 200;
		//该生成多少个ul
		var oUl_num = Math.floor(oBox_width / oUl_width);
		//每个ul之间的margin-left
		var oUl_margin_left = Math.floor((oBox_width - oUl_width*oUl_num) / (oUl_num+1));
		//生成ul
		oUlDelete();
		for(var i=1;i<=oUl_num;i++){
			var oUl = document.createElement("ul");
			oBox.appendChild(oUl);
			oUl.style.marginLeft = oUl_margin_left + 'px';
			oUl.style.left = i*oUl_margin_left + (i-1)*oUl_width + 'px';
			oUl.style.offsetLeft = i*oUl_margin_left + (i-1)*oUl_width + 'px';
		}
	}
	//求得最小高度
	function min_height(oUl){
		var ht = oUl[0].offsetHeight;
		var index = 0;				
		for(var i=0;i< oUl.length;i++){		
			if(oUl[i].offsetHeight < ht){
				ht = oUl[i].offsetHeight;
				index = i;
			}
		}
		return index;
	}
	//生成li
	function loadImg(){
		waterFull();
		var oBox = document.querySelector('.box');
		var oUl = oBox.querySelectorAll('ul');
		ajax("index.json",function(data){
			data = (new Function("return" + data))();
			for(var i=0;i<data.length;i++){
				var oLi = document.createElement("li");
				var oImg = document.createElement("img");
				oImg.src = data[i];
				oLi.appendChild(oImg);
				oUl[min_height(oUl)].appendChild(oLi);
				
			}
		})
	}
</script>
